# ネットワーク関連のTIPSをまとめるページ

## ファイアウォール設定ツールについて

Webページを検索すると`iptables`だけではなく`ufw`や`nftables`などを使用している例が見られる。違いがわかっていないので整理しておく。ChartGPTによると

```
ufw、nftables、iptablesは、いずれもLinuxにおいてファイアウォールを構成するために利用されるツールですが、それぞれ特徴が異なります。

iptables
iptablesは、最も一般的なLinuxのファイアウォールツールです。iptablesは、iptablesコマンドを使用してファイアウォールルールを設定します。iptablesは、パケットフィルタリングとNAT機能をサポートしており、さまざまなプロトコルやオプションを使用して細かい設定ができます。ただし、複雑であり学習コストが高いため、設定が難しいという欠点があります。

ufw
ufwは、iptablesをより簡単に使えるようにするユーザーフレンドリーなフロントエンドです。ufwは、コマンドラインから使用することができますが、GUIツールも利用可能です。ufwは、設定が簡単で、ルールの追加と削除が簡単に行えるため、iptablesよりもより初心者に優しいです。

nftables
nftablesは、iptablesの後継として登場した新しいLinuxファイアウォールです。nftablesは、パケットフィルタリングとNAT機能をサポートしており、設定が簡単で高速な処理が可能です。nftablesは、iptablesよりも柔軟性があり、IPv4およびIPv6の両方をサポートしています。ただし、まだまだ新しい技術であり、設定が複雑であったり、既存のシステムとの互換性の問題がある場合があります。
```

ということで`ufw`は`iptables`を設定するためのツールであるため、

- 古いファイアウォール: iptables
- 新しいファイアウォール: nftables

ということのようだ。


## ネットワークインターフェースについて

### ネットワークインターフェースの一覧を確認する

```
$ ip a
```

### ネットワークインターフェースを削除する

DockerやLXDなどでネットワーク周りの設定を編集しているといつのまにか多数のなんだかよくわからないインターフェースが追加されていて気持ち悪い。インターフェースを削除するには次のコマンドを実行する。

```
sudo ip link delete <インターフェース名>
```

### ネットワークインターフェースの一般的な名称について

Webページの検索しているとよく見る名前として`eth0`などがあるが、最近のOSではそのような名前になっていないこともよくあり混乱しがちである。これらの名前の由来的なものを整理しておく。ちなみに自分のUbuntu 22.04では`enp1s0f0`という名前になっている。この名前についてChatGPTに確認したところ以下の回答が得られた。

```
「enp1s0f0」というのは、Linuxでネットワークインターフェイスを識別する命名規則の1つで、enpはEthernet Controllerの略称、1s0f0は「PCIスロット1のスロット0のファンクション0」を意味します。つまり、このインターフェイスは、PCIバスを介して接続されたEthernetコントローラのインターフェイスであることを示しています。

近年、Linuxでは従来の「ethX」という命名規則から、より意味のある識別子を用いた「Predictable Network Interface Names」（予測可能なネットワークインタフェース名）に移行しています。そのため、新しいLinuxシステムでは、インターフェイス名に「enp1s0f0」のような命名規則が使用されることが一般的です。

ただし、旧来の「ethX」の命名規則もまだ一部の環境で使用されており、またユーザーが明示的に変更することもできます。そのため、「eth0」が「enp1s0f0」に置き換えられたわけではなく、単にLinuxシステムの新しい命名規則が適用されているということです。
```

つづいてよく見る名前として`ens33`などがある。この名前についてもChatGPTから回答が得られた。

```
「ens33」という名前は、Linuxでネットワークインターフェースを識別する命名規則の1つで、より意味のある識別子を用いた「Predictable Network Interface Names」（予測可能なネットワークインタフェース名）に従った命名規則です。

「ens」は、Ethernet Network Deviceを意味し、「33」はシステムの起動時に識別されたネットワークインターフェースの番号を表しています。つまり、「ens33」は、システムの起動時に検出されたEthernetネットワークインターフェースの33番目のインターフェースを示します。

「ens33」は、VMwareなどの仮想化ソフトウェアで、仮想ネットワークインターフェースを識別するために使用されることが多いです。このような場合、「ens33」は、仮想マシンのホストシステムに接続された物理ネットワークアダプターに対応することが多いです。
```

## 事例1

LXDコンテナに独自のネットワークアドレスを設定しLXDホストからpingを通す。

- ホストネットワーク: 192.168.11.0/24
- LXDネットワーク: 192.168.111.0/24

### LXDのネットワークを作成する

```
$ sudo lxc network create network2 \
  ipv4.address=192.168.111.1/24 \
  ipv4.nat=false
```

これにより、network2という名前のネットワークが作成され、IPアドレス192.168.111.1/24が割り当てられます。

### ネットワーク2にコンテナを接続する

```
$ sudo lxc launch ubuntu:18.04 mycontainer -n network2
```

これにより、mycontainerという名前のコンテナが作成され、ネットワーク2に接続されます。

### ネットワーク1とネットワーク2をルーティングする

```
$ sudo iptables -t nat -A POSTROUTING -s 192.168.11.0/24 -d 192.168.111.0/24 -j MASQUERADE
```

これにより、ネットワーク1からネットワーク2にパケットがルーティングされるようになります。

### ネットワーク1のホストに対して、ネットワーク2のコンテナに対するルートを設定する

```
$ sudo ip route add 192.168.111.0/24 via 192.168.11.1
```

これにより、ネットワーク1内のホストからネットワーク2のコンテナにアクセスするためのルートが設定されます。
