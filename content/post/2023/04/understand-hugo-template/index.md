---
title: 'Hugoのテンプレート(ショートコード)の使い方を整理しておく'
date: '2023-04-03'
tags:
  - hugo
  - blog

thumbnail: golang
featureImage: "./top.jpg"

summary: "このブログはHugoというGo言語製のジェネレータを使っています。すでに執筆作業中に冗長さを感じたり後で手直しが発生した場合にあちこち直して回らなければならないだろうな、ということが見えてしまって、モヤモヤしています。効率的な記事執筆のためにHugoのテンプレート機能の使い方についてまとめておくことにします。"

draft: true
---

### Hugoのテンプレートについて

Hugoで使用するテンプレート言語はHugo付属の専用テンプレート言語ではなくGo言語の標準ライブラリであるhtml/templateおよびtext/templateというライブラリが使われています。が、Hugoを使うにあたりGo言語の知識が必要になることはなさそうです(今のところは。おそらく今後もない)。

### この記事で扱う内容

記事を書いている際に不便だなと感じたときに独自のショートコードを定義して解決できるようになることを目指します。実際に記事を執筆している段階で私が欲しいと思っていたショートコードを実装しましたのでそちらも紹介していきます。

{{% notice tip "MEMO" %}}
この記事内で実装するショートコードを実行するためにはextendedバージョンのhugoが必要です
{{% /notice %}}

### テンプレート記法の基本

ショートコードの実装に入る前に前提となる基本知識を押さえておきます。ショートコードはルートディレクトリ下のlayouts/shortcodesに配置します。ショートコード名.htmlという名前でファイルを作成します。例としてhello.htmlというショートコードを作成してみます。

```html
<div style="padding: 5px; border: 1px solid black;">Hello, World!!</div>
```

このショートコードをマークダウン内で`{{</*hello*/>}}`のように記述して使うことができます。なおショートコードの名前(ここではhello)を囲む、左右の開始と終了の3文字の記号はひと続きである必要があります。つまり、

- `{{</*hello*/>}}`
- `{{</*　hello　*/>}}`

上記の二つは正しい記述ですが、

- `{{ <hello> }}`

こちらの記述は不正なので注意しましょう(気づかなくて少しハマりました)。

実際に使った場合、次のように表示されます：

<blockquote>
{{< hello1 >}}
</blockquote>

### 定義済みの変数にアクセスする

テンプレートから`Page`オブジェクトで定義されているプロパティにアクセスしてみます。Pageオブジェクトはその名前の通りページに関する情報を保持しています。
例えばこのページのタイトルを表示してみます。hello.htmlを次のように修正します。

```html
<div style="padding: 5px; border: 1px solid black;">Hello, {{.Page.Title}}!!</div>
```

修正後に再度ショートコードを使うと、次のように表示されます：

<blockquote>
{{< hello2 >}}
</blockquote>

Pageの前についている「.」はコンテキストを表します。マークダウン内でショートコードを記述した場合、
デフォルトのコンテキストとして現在のページのコンテキストが設定されます。
コンテキストからはPageオブジェクトや`Site`オブジェクトにアクセスすることができます。
またPageオブジェクトが持つ`Params`オブジェクトからフロントマターの情報にもアクセスできます。これらの情報にアクセスするようにさらにhello.htmlを修正してみます。

```html
<div style="padding: 5px; border: 1px solid black;">
  Hello, World!!
  <ul>
    <li>Site Title: {{ .Site.Title }}</li>
    <li>Page Title: {{ .Page.Title }}</li>
    <li>Tags: {{ .Page.Params.tags }}</li>
  </ul>
</div>
```

表示してみます：

<blockquote>
{{< hello3 >}}
</blockquote>

コンテキストは切り替えることが可能です。例えば`with`を使うことで任意のオブジェクトをコンテキストとして設定できます。また要素のコレクションを`range`でループする際は、現在対象としている要素がコンテキストに自動で設定されます。実際に確認してみます。hello.htmlを次のように修正します：

```html
<div style="padding: 5px; border: 1px solid black;">
  Hello, World!!
  <ul>
    <li>Site Title: {{ with .Site }}{{ .Title }}{{ end }}</li>
    <li>Page Title: {{ with .Page }}{{ .Title }}{{ end }}</li>
    <li>Tags: {{ range .Page.Params.tags }} {{ . }} {{ end }}</li>
  </ul>
</div>
```

表示してみます：

<blockquote>
{{< hello4 >}}
</blockquote>

ひとつ前の例とほぼ同じ内容が表示されましたが、前回はTagsの配列をそのまま表示していたので、配列を表す角カッコが表示されていたのに対し、
今回のバージョンでは要素をひとつづつ取り出しながら表示しているので角カッコがなくなっているのがわかります。

### ショートコードに引数を渡す

これまで作成したショートコードは呼び出し時にパラメータを渡すことができなかったのでパラメータを渡せるように修正してみます。

```html
<div style="padding: 5px; border: 1px solid black;">Hello, { .Get 0 }!!!</div>
```

まあ見れば意味わかるよね、って程度の内容なので説明は割愛で。使う側では以下のようにパラメータを指定します。

- `{{</* hello "World" */>}}`

表示してみます：

<blockquote>
{{< hello5 "World" >}}
</blockquote>

### 名前付きパラメータを使う

前の例でパラメータの位置番号(0)を指定していた箇所をパラメータ名に変えることで名前付きパラメータを使うことができます。以下のように修正します。

```html
<div style="padding: 5px; border: 1px solid black;">Hello, {{ .Get "name" }}!!!!</div>
```

使う側では以下のようにパラメータを指定します。

- `{{</* hello name="World" */>}}`

表示してみます：

<blockquote>
{{< hello6 name="World" >}}
</blockquote>

### 実践編： 実際に使うショートコードを実装する

次のような使い方をするショートコードを実装します：`{{</* i 1 500 500 */>}}`

`i`はimageの略です。つまりこのショートコードは`<img>`タグを生成します。使用頻度が高いのでなるべく簡単に書けるように1文字にしました。

#### 1番目の引数

最初の引数である1は画像ファイルのパスのプレフィクスです。記事と同じ階層にある複数の画像ファイルの中からプレフィクスが一致するファイルを選択し、
その画像のパスをimgタグのsrcに設定するようにします。

このショートコードの狙いとしては、そもそも画像ファイルのパスをフルで書くのが面倒くさいので省エネするためです。
また後から画像ファイル名を変更した際に修正する手間がなくなるという狙いもあります(割と頻繁に名前を変えるため)。

前提としてはプレフィクスに一致するファイルが必ず一つだけ存在するように注意する必要があるということです。
私が必ずそのような状態になるように運用するのでファイル存在チェックのようなものは基本的には行いません。

#### 2,3番目の引数

画像の縦幅、横幅になります。ここで指定した幅にリサイズした新しい画像を生成するようにします。

#### コード

{{< i "t" "resize" 512>}}
{{< i "t" "crop" 512 512>}}
{{< i "t" "fill" 512 512>}}
{{< i "t" "fit" 512 512>}}
